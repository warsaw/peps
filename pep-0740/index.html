
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 740 – Index support for digital attestations | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0740/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://peps.python.org/peps.rss">
    <meta property="og:title" content='PEP 740 – Index support for digital attestations | peps.python.org'>
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://peps.python.org/pep-0740/">
    <meta property="og:site_name" content="Python Enhancement Proposals (PEPs)">
    <meta property="og:image" content="https://peps.python.org/_static/og-image.png">
    <meta property="og:image:alt" content="Python PEPs">
    <meta property="og:image:width" content="200">
    <meta property="og:image:height" content="200">
    <meta name="description" content="Python Enhancement Proposals (PEPs)">
    <meta name="theme-color" content="#3776ab">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 740</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 740 – Index support for digital attestations</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">William Woodruff &lt;william&#32;&#97;t&#32;yossarian.net&gt;,
Facundo Tuesca &lt;facundo.tuesca&#32;&#97;t&#32;trailofbits.com&gt;</dd>
<dt class="field-even">Sponsor<span class="colon">:</span></dt>
<dd class="field-even">Donald Stufft &lt;donald&#32;&#97;t&#32;stufft.io&gt;</dd>
<dt class="field-odd">PEP-Delegate<span class="colon">:</span></dt>
<dd class="field-odd">Donald Stufft &lt;donald&#32;&#97;t&#32;stufft.io&gt;</dd>
<dt class="field-even">Discussions-To<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="https://discuss.python.org/t/pep-740-index-support-for-digital-attestations/44498">Discourse thread</a></dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd"><abbr title="Proposal under active discussion and revision">Draft</abbr></dd>
<dt class="field-even">Type<span class="colon">:</span></dt>
<dd class="field-even"><abbr title="Non-normative PEP containing background, guidelines or other information relevant to the Python ecosystem">Informational</abbr></dd>
<dt class="field-odd">Topic<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="../topic/packaging/">Packaging</a></dd>
<dt class="field-even">Created<span class="colon">:</span></dt>
<dd class="field-even">08-Jan-2024</dd>
<dt class="field-odd">Post-History<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="https://discuss.python.org/t/pre-pep-exposing-trusted-publisher-provenance-on-pypi/42337" title="Discourse thread">02-Jan-2024</a>,
<a class="reference external" href="https://discuss.python.org/t/pep-740-index-support-for-digital-attestations/44498" title="Discourse thread">29-Jan-2024</a></dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#rationale-and-motivation">Rationale and Motivation</a><ul>
<li><a class="reference internal" href="#design-considerations">Design Considerations</a></li>
<li><a class="reference internal" href="#previous-work">Previous Work</a><ul>
<li><a class="reference internal" href="#pgp-signatures">PGP signatures</a></li>
<li><a class="reference internal" href="#wheel-signatures">Wheel signatures</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#upload-endpoint-changes">Upload endpoint changes</a></li>
<li><a class="reference internal" href="#index-changes">Index changes</a><ul>
<li><a class="reference internal" href="#provenance-objects">Provenance objects</a></li>
<li><a class="reference internal" href="#simple-index">Simple Index</a></li>
<li><a class="reference internal" href="#json-based-simple-api">JSON-based Simple API</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#security-implications">Security Implications</a><ul>
<li><a class="reference internal" href="#index-trust">Index trust</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recommendations">Recommendations</a></li>
<li><a class="reference internal" href="#appendix-1-example-uploaded-attestations">Appendix 1: Example Uploaded Attestations</a></li>
<li><a class="reference internal" href="#appendix-2-example-trusted-publisher-representation">Appendix 2: Example Trusted Publisher Representation</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p>This PEP proposes a collection of changes related to the upload and distribution
of digitally signed attestations and metadata used to verify them on a Python
package repository, such as PyPI.</p>
<p>These changes have two subcomponents:</p>
<ul class="simple">
<li>Changes to the currently unstandardized PyPI upload API, allowing clients
to upload digital attestations;</li>
<li>Changes to the <a class="pep reference internal" href="../pep-0503/" title="PEP 503 – Simple Repository API">PEP 503</a> and <a class="pep reference internal" href="../pep-0691/" title="PEP 691 – JSON-based Simple API for Python Package Indexes">PEP 691</a> “simple” APIs, allowing clients
to retrieve both digital attestations and
<a class="reference external" href="https://docs.pypi.org/trusted-publishers/">Trusted Publishing</a> metadata
for individual release files.</li>
</ul>
<p>This PEP does not recommend a specific digital attestation format, nor does
it make a policy recommendation around mandatory digital attestations on
release uploads or their subsequent verification by installing clients like
<code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
</section>
<section id="rationale-and-motivation">
<h2><a class="toc-backref" href="#rationale-and-motivation" role="doc-backlink">Rationale and Motivation</a></h2>
<p>Desire for digital signatures on Python packages has been repeatedly
expressed by both package maintainers and downstream users:</p>
<ul class="simple">
<li>Maintainers wish to demonstrate the integrity and authenticity of their
package uploads;</li>
<li>Individual downstream users wish to verify package integrity and authenticity
without placing additional trust in their index’s honesty;</li>
<li>“Bulk” downstream users (such as Operating System distributions) wish to
perform similar verifications and potentially re-expose or countersign
for their own downstream packaging ecosystems.</li>
</ul>
<p>This proposal seeks to accommodate each of the above use cases.</p>
<p>Additionally, this proposal identifies the following motivations:</p>
<ul>
<li>Verifiable provenance for Python package distributions: many Python
packages currently contain <em>unauthenticated</em> provenance metadata, such
as URLs for source hosts. A cryptographic attestation format could enable
strong <em>authenticated</em> links between these packages and their source hosts,
allowing both the index and downstream users to cryptographically verify that
a package originates from its claimed source repository.</li>
<li>Raising attacker requirements: an attacker who seeks to take
over a Python package can be described along <em>sophistication</em>
(unsophisticated to sophisticated) and <em>targeting</em> dimensions
(opportunistic to targeted).<p>Digital attestations impose additional sophistication requirements: the
attacker must be sufficiently sophisticated to access private signing material
(or signing identities). They also impose additional targeting requirements:
the release consistency requirement (mentioned below) means that the attacker
cannot upload <em>any</em> attestation, but only one of a type already seen for a
particular release. In the future, this could be further “ratcheted” down
by allowing project maintainers to disable releases without attestations
entirely.</p>
</li>
<li>Release consistency: in the status quo, the only attestation provided by the
index is an optional PGP signature per release file
(see <a class="reference internal" href="#pgp-signatures"><span class="std std-ref">PGP signatures</span></a>). These signatures are not
checked by the index either for well-formedness or for validity, since
the index has no mechanism for identifying the right public key for the
signature.<p>Additionally, the index does not have an “all or none” requirement
for PGP signatures, meaning that there is no consistency requirement
between distributions within a release (and that maintainers may
accidentally forget to upload signatures when adding additional
release distributions).</p>
</li>
</ul>
<p>While this PEP does not recommend a specific digital attestation format,
it does recognize the utility of Trusted Publishing as a pre-existing,
“zero-configuration” source of strong provenance for Python packages.
Consequently this PEP includes a proposed scheme for exposing each release
file’s Trusted Publisher metadata, with the expectation that a future digital
attestation format will likely make use of it.</p>
<section id="design-considerations">
<h3><a class="toc-backref" href="#design-considerations" role="doc-backlink">Design Considerations</a></h3>
<p>This PEP identifies the following design considerations when evaluating
both its own proposed changes and previous work in the same or adjacent
areas of Python packaging:</p>
<ol class="arabic">
<li>Index accessibility: digital attestations for Python packages
are ideally retrievable directly from the index itself, as “detached”
resources.<p>This both simplifies some compatibility concerns (by avoiding
the need to modify the distribution formats themselves) and also simplifies
the behavior of potential installing clients (by allowing them to
retrieve each attestation before its corresponding package without needing
to do streaming decompression).</p>
</li>
<li>Verification by the index itself: in addition to enabling verification
by installing clients, each digital attestation is <em>ideally</em> verifiable
in some form by the index itself.<p>This both increases the overall quality
of attestations uploaded to the index (preventing, for example, users
from accidentally uploading incorrect or invalid attestations) and also
enables UI and UX refinements on the index itself (such as a “provenance”
view for each uploaded package).</p>
</li>
<li>General applicability: digital attestations should be applicable to
<em>any and every</em> package uploaded to the index, regardless of its format
(sdist or wheel) or interior contents.</li>
<li>Metadata support: this PEP refers to “digital attestations” rather than
just “digital signatures” to emphasize the ideal presence of additional
metadata within the cryptographic envelope.<p>For example, to prevent domain separation between a distribution’s name and
its contents, the digital attestation could be performed over
<code class="docutils literal notranslate"><span class="pre">HASH(name</span> <span class="pre">||</span> <span class="pre">HASH(contents))</span></code> rather than just <code class="docutils literal notranslate"><span class="pre">HASH(contents)</span></code>.</p>
</li>
<li>Consistent release attestations: if a file belonging to a release has a
set of digital attestations, then all of the other files belonging to that
release should also have the same types of attestations.<p>This simplifies the downstream use story for digital attestations, and
prevents potentially vulnerable “swiss cheese” release patterns (where
a verifier checks for a valid attestation on <code class="docutils literal notranslate"><span class="pre">HolyGrail-1.0.tar.gz</span></code>
but their installing client actually resolves an attacker-controlled,
platform-specific <code class="docutils literal notranslate"><span class="pre">.whl</span></code> instead).</p>
</li>
</ol>
</section>
<section id="previous-work">
<h3><a class="toc-backref" href="#previous-work" role="doc-backlink">Previous Work</a></h3>
<section id="pgp-signatures">
<span id="id1"></span><h4><a class="toc-backref" href="#pgp-signatures" role="doc-backlink">PGP signatures</a></h4>
<p>PyPI and other indices have historically supported PGP signatures on uploaded
distributions. These could be supplied during upload, and could be retrieved
by installing clients via the <code class="docutils literal notranslate"><span class="pre">data-gpg-sig</span></code> attribute in the <a class="pep reference internal" href="../pep-0503/" title="PEP 503 – Simple Repository API">PEP 503</a>
API, the <code class="docutils literal notranslate"><span class="pre">gpg-sig</span></code> key on the <a class="pep reference internal" href="../pep-0691/" title="PEP 691 – JSON-based Simple API for Python Package Indexes">PEP 691</a> API, or via an adjacent
<code class="docutils literal notranslate"><span class="pre">.asc</span></code>-suffixed URL.</p>
<p>PGP signature uploads have been disabled on PyPI since
<a class="reference external" href="https://blog.pypi.org/posts/2023-05-23-removing-pgp/">May 2023</a>, after
<a class="reference external" href="https://blog.yossarian.net/2023/05/21/PGP-signatures-on-PyPI-worse-than-useless">an investigation</a>
determined that the majority of signatures (which, themselves, constituted a
tiny percentage of overall uploads) could not be associated with a public key or
otherwise meaningfully verified.</p>
<p>In their previously supported form on PyPI, PGP signatures satisfied
considerations (1) and (3) above but not (2) (owing to the need for external
keyservers and key distribution) or (4) (due to PGP signatures typically being
constructed over just an input file, without any associated signed metadata).
Similarly, PyPI’s historical implementation of PGP did not satisfy consideration
(5), due to a lack of consistency checks between different release files
(and an inability to perform those checks due to no access to the signer’s
public key).</p>
</section>
<section id="wheel-signatures">
<h4><a class="toc-backref" href="#wheel-signatures" role="doc-backlink">Wheel signatures</a></h4>
<p><a class="pep reference internal" href="../pep-0427/" title="PEP 427 – The Wheel Binary Package Format 1.0">PEP 427</a> (and its <a class="reference external" href="https://packaging.python.org/en/latest/specifications/binary-distribution-format/#binary-distribution-format" title="(in Python Packaging User Guide)"><span class="xref std std-ref">living PyPA counterpart</span></a>)
specify the <a class="reference external" href="https://packaging.python.org/en/latest/glossary/#term-Wheel" title="(in Python Packaging User Guide)"><span class="xref std std-term">wheel format</span></a>.</p>
<p>This format includes accommodations for digital signatures embedded directly
into the wheel, in either JWS or S/MIME format. These signatures are specified
over a <a class="pep reference internal" href="../pep-0376/" title="PEP 376 – Database of Installed Python Distributions">PEP 376</a> RECORD, which is modified to include a cryptographic digest
for each recorded file in the wheel.</p>
<p>While wheel signatures are fully specified, they do not appear to be broadly
used; the official <a class="reference external" href="https://github.com/pypa/wheel">wheel tooling</a> deprecated
signature generation and verification support
<a class="reference external" href="https://wheel.readthedocs.io/en/stable/news.html">in 0.32.0</a>, which was
released in 2018.</p>
<p>Additionally, wheel signatures do not satisfy any of
the above considerations (due to the “attached” nature of the signatures,
non-verifiability on the index itself, and support for wheels only).</p>
</section>
</section>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification" role="doc-backlink">Specification</a></h2>
<section id="upload-endpoint-changes">
<span id="upload-endpoint"></span><h3><a class="toc-backref" href="#upload-endpoint-changes" role="doc-backlink">Upload endpoint changes</a></h3>
<p>The current upload API is not standardized. However, we propose the following
changes to it:</p>
<ul class="simple">
<li>In addition to the current top-level <code class="docutils literal notranslate"><span class="pre">content</span></code> and <code class="docutils literal notranslate"><span class="pre">gpg_signature</span></code> fields,
the index <strong>SHALL</strong> accept <code class="docutils literal notranslate"><span class="pre">attestations</span></code> as an additional multipart form
field.</li>
<li>The new <code class="docutils literal notranslate"><span class="pre">attestations</span></code> field <strong>SHALL</strong> be a JSON object.</li>
<li>The JSON object <strong>SHALL</strong> have one or more keys, each identifying an
attestation format known to the index. If any key does not identify an
attestation format known to the index, the index <strong>MUST</strong> reject the upload.</li>
<li>The value associated with each well-known key <strong>SHALL</strong> be a JSON object.</li>
<li>Each attestation value <strong>MUST</strong> be verifiable by the index. If the index fails
to verify any attestation in <code class="docutils literal notranslate"><span class="pre">attestations</span></code>, it <strong>MUST</strong> reject the upload.</li>
</ul>
<p>In addition to the above, the index <strong>SHALL</strong> enforce a consistency
policy for release attestations via the following:</p>
<ul class="simple">
<li>If the first file under a new release is supplied with <code class="docutils literal notranslate"><span class="pre">attestations</span></code>,
then all subsequently uploaded files under the same release <strong>MUST</strong> also
have <code class="docutils literal notranslate"><span class="pre">attestations</span></code>. Conversely, if the first file under a new release
does not have any <code class="docutils literal notranslate"><span class="pre">attestations</span></code>, then all subsequent uploads under the
same release <strong>MUST NOT</strong> have <code class="docutils literal notranslate"><span class="pre">attestations</span></code>.</li>
<li>All files under the same release <strong>MUST</strong> have the same set of well-known
attestation format keys.</li>
</ul>
<p>The index <strong>MUST</strong> reject any file upload that does not satisfy these
consistency properties.</p>
</section>
<section id="index-changes">
<h3><a class="toc-backref" href="#index-changes" role="doc-backlink">Index changes</a></h3>
<section id="provenance-objects">
<span id="provenance-object"></span><h4><a class="toc-backref" href="#provenance-objects" role="doc-backlink">Provenance objects</a></h4>
<p>The index will serve uploaded attestations along with metadata that can assist
in verifying them in the form of JSON serialized objects.</p>
<p>These “provenance objects” will be available via both the <a class="pep reference internal" href="../pep-0503/" title="PEP 503 – Simple Repository API">PEP 503</a> Simple Index
and <a class="pep reference internal" href="../pep-0691/" title="PEP 691 – JSON-based Simple API for Python Package Indexes">PEP 691</a> JSON-based Simple API as described below, and will have the
following structure:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;publisher&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;important-ci-service&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;claims&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">      </span><span class="nt">&quot;vendor-property&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;another-property&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;attestations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;some-attestation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="cm">/* ... */</span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;another-attestation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="cm">/* ... */</span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul>
<li><code class="docutils literal notranslate"><span class="pre">publisher</span></code> is an <strong>optional</strong> JSON object, containing a
representation of the file’s Trusted Publisher configuration at the time
the file was uploaded to the package index. The keys within the <code class="docutils literal notranslate"><span class="pre">publisher</span></code>
object are specific to each Trusted Publisher but include, at minimum:<ul class="simple">
<li>A <code class="docutils literal notranslate"><span class="pre">type</span></code> key, which <strong>MUST</strong> be a JSON string that uniquely identifies the
kind of Trusted Publisher.</li>
<li>A <code class="docutils literal notranslate"><span class="pre">claims</span></code> key, which <strong>MUST</strong> be a JSON object containing any context-specific
claims retained by the index during Trusted Publisher authentication.</li>
</ul>
<p>All other keys in the <code class="docutils literal notranslate"><span class="pre">publisher</span></code> object are publisher-specific. A full
illustrative example of a <code class="docutils literal notranslate"><span class="pre">publisher</span></code> object is provided in <a class="reference internal" href="#appendix-2"><span class="std std-ref">Appendix 2: Example Trusted Publisher Representation</span></a>.</p>
</li>
<li><code class="docutils literal notranslate"><span class="pre">attestations</span></code> is a <strong>required</strong> JSON object, containing one or
more attestation objects as identified by their keys. This object is
a superset of <code class="docutils literal notranslate"><span class="pre">attestations</span></code> object supplied by the uploader through the
<code class="docutils literal notranslate"><span class="pre">attestations</span></code> field, as described in <a class="reference internal" href="#upload-endpoint"><span class="std std-ref">Upload endpoint changes</span></a>.<p>Because <code class="docutils literal notranslate"><span class="pre">attestations</span></code> is a superset of the file’s original uploaded attestations,
the index <strong>MAY</strong> chose to embed additional attestations of its own.</p>
</li>
</ul>
</section>
<section id="simple-index">
<h4><a class="toc-backref" href="#simple-index" role="doc-backlink">Simple Index</a></h4>
<ul class="simple">
<li>When an uploaded file has one or more attestations, the index <strong>MAY</strong> include a
<code class="docutils literal notranslate"><span class="pre">data-provenance</span></code> attribute on its file link, with a value of either
<code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>.</li>
<li>When <code class="docutils literal notranslate"><span class="pre">data-provenance</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code>, the index <strong>MUST</strong> serve a
<a class="reference internal" href="#provenance-object"><span class="std std-ref">provenance object</span></a> at the same URL, but with
<code class="docutils literal notranslate"><span class="pre">.provenance</span></code> appended to it. For example, if <code class="docutils literal notranslate"><span class="pre">HolyGrail-1.0.tar.gz</span></code>
exists and has associated attestations, those attestations would be located
within the provenance object hosted at <code class="docutils literal notranslate"><span class="pre">HolyGrail-1.0.tar.gz.provenance</span></code>.</li>
</ul>
</section>
<section id="json-based-simple-api">
<h4><a class="toc-backref" href="#json-based-simple-api" role="doc-backlink">JSON-based Simple API</a></h4>
<ul class="simple">
<li>When an uploaded file has one or more attestations, the index <strong>MAY</strong> include a
<code class="docutils literal notranslate"><span class="pre">provenance</span></code> object in the <code class="docutils literal notranslate"><span class="pre">file</span></code> dictionary for that file.</li>
<li><code class="docutils literal notranslate"><span class="pre">provenance</span></code>, when present, <strong>MUST</strong> be a <a class="reference internal" href="#provenance-object"><span class="std std-ref">provenance object</span></a>.</li>
</ul>
<p>These changes require a version change to the JSON API:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">api-version</span></code> must specify version 1.2 or later.</li>
</ul>
</section>
</section>
</section>
<section id="security-implications">
<h2><a class="toc-backref" href="#security-implications" role="doc-backlink">Security Implications</a></h2>
<p>This PEP is “mechanical” in nature; it provides only the plumbing for future
digital attestations on package indices, without specifying their concrete
cryptographic details.</p>
<p>As such, we do not identify any positive or negative security implications
for this PEP.</p>
<section id="index-trust">
<h3><a class="toc-backref" href="#index-trust" role="doc-backlink">Index trust</a></h3>
<p>This PEP does <strong>not</strong> increase (or decrease) trust in the index itself:
the index is still effectively trusted to honestly deliver unmodified package
distributions, since a dishonest index capable of modifying package
contents could also dishonestly modify or omit package attestations.
As a result, this PEP’s presumption of index trust is equivalent to the
unstated presumption with earlier mechanisms, like PGP and Wheel signatures.</p>
<p>This PEP does not preclude or exclude future index trust mechanisms, such
as <a class="pep reference internal" href="../pep-0458/" title="PEP 458 – Secure PyPI downloads with signed repository metadata">PEP 458</a> and/or <a class="pep reference internal" href="../pep-0480/" title="PEP 480 – Surviving a Compromise of PyPI: End-to-end signing of packages">PEP 480</a>.</p>
</section>
</section>
<section id="recommendations">
<h2><a class="toc-backref" href="#recommendations" role="doc-backlink">Recommendations</a></h2>
<p>This PEP does not recommend specific attestation formats. It does,
however, make the following recommendations to package indices seeking
to create new or implement pre-existing attestation formats:</p>
<ol class="arabic simple">
<li>Consult the <a class="reference external" href="https://packaging.python.org/en/latest/specifications/#packaging-specifications" title="(in Python Packaging User Guide)"><span class="xref std std-ref">living PyPA specifications</span></a>
first, and determine if any currently defined attestation formats suit
your purpose.</li>
<li>If no suitable attestation format is defined under the PyPA specifications,
consider submitting it to the PyPA specifications for longevity and reuse
purposes.</li>
</ol>
<p>When designing a new attestation format, we make the following recommendations:</p>
<ol class="arabic">
<li>Pick a short, but unique name for your attestation format; this name will
serve as the attestation’s identifier in the upload and index APIs.<p>When appropriate for an attestation format, we recommend using <code class="docutils literal notranslate"><span class="pre">:</span></code> as a
domain separator. For example, an attestation format that provides publish
provenance using <a class="reference external" href="https://www.sigstore.dev/">Sigstore</a> might have the
name <code class="docutils literal notranslate"><span class="pre">sigstore:publish</span></code>.</p>
</li>
<li>Prefer parsimony in your format: avoid optional fields and functionality,
avoid unnecessary cryptographic agility and message malleability, and ensure
that verifying the attestation communicates something meaningful beyond a
basic integrity check (since the index itself already supplies cryptographic
digests for this purpose).</li>
</ol>
</section>
<section id="appendix-1-example-uploaded-attestations">
<span id="appendix-1"></span><h2><a class="toc-backref" href="#appendix-1-example-uploaded-attestations" role="doc-backlink">Appendix 1: Example Uploaded Attestations</a></h2>
<p>This appendix provides a fictional example of the <code class="docutils literal notranslate"><span class="pre">attestations</span></code> field
submitted on file upload, with two fictional attestations (<code class="docutils literal notranslate"><span class="pre">publish</span></code> and
<code class="docutils literal notranslate"><span class="pre">timestamp</span></code>):</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;publish&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;mediaType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;application/vnd.dev.sigstore.bundle+json;version=0.2&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;verificationMaterial&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* omitted for brevity */</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;messageSignature&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;messageDigest&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;algorithm&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;some-hash-algo&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;digest&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;digest-here&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;signature&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;signature-here&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;cms&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;some-long-blob-here&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The payloads of these fictional attestations are purely illustrative.</p>
</section>
<section id="appendix-2-example-trusted-publisher-representation">
<span id="appendix-2"></span><h2><a class="toc-backref" href="#appendix-2-example-trusted-publisher-representation" role="doc-backlink">Appendix 2: Example Trusted Publisher Representation</a></h2>
<p>This appendix provides a fictional example of a <code class="docutils literal notranslate"><span class="pre">publisher</span></code> key within
a <a class="pep reference internal" href="../pep-0691/" title="PEP 691 – JSON-based Simple API for Python Package Indexes">PEP 691</a> <code class="docutils literal notranslate"><span class="pre">project.files[].provenance</span></code> listing:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;publisher&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GitHub&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;claims&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;refs/tags/v1.0.0&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;sha&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;da39a3ee5e6b4b0d3255bfef95601890afd80709&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;repository_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HolyGrail&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;repository_owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;octocat&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;repository_owner_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;workflow_filename&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;publish.yml&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;environment&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document is placed in the public domain or under the
CC0-1.0-Universal license, whichever is more permissive.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/peps/pep-0740.rst">https://github.com/python/peps/blob/main/peps/pep-0740.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/peps/pep-0740.rst">2024-02-10 18:48:19 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#rationale-and-motivation">Rationale and Motivation</a><ul>
<li><a class="reference internal" href="#design-considerations">Design Considerations</a></li>
<li><a class="reference internal" href="#previous-work">Previous Work</a><ul>
<li><a class="reference internal" href="#pgp-signatures">PGP signatures</a></li>
<li><a class="reference internal" href="#wheel-signatures">Wheel signatures</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#upload-endpoint-changes">Upload endpoint changes</a></li>
<li><a class="reference internal" href="#index-changes">Index changes</a><ul>
<li><a class="reference internal" href="#provenance-objects">Provenance objects</a></li>
<li><a class="reference internal" href="#simple-index">Simple Index</a></li>
<li><a class="reference internal" href="#json-based-simple-api">JSON-based Simple API</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#security-implications">Security Implications</a><ul>
<li><a class="reference internal" href="#index-trust">Index trust</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recommendations">Recommendations</a></li>
<li><a class="reference internal" href="#appendix-1-example-uploaded-attestations">Appendix 1: Example Uploaded Attestations</a></li>
<li><a class="reference internal" href="#appendix-2-example-trusted-publisher-representation">Appendix 2: Example Trusted Publisher Representation</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/peps/pep-0740.rst">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
    <script src="../_static/sticky_banner.js"></script>
</body>
</html>